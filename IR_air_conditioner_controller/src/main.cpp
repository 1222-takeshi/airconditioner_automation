#include <Arduino.h>

/*********
  Rui Santos
  Complete project details at https://randomnerdtutorials.com
*********/

#define PIN_SEND 4

#define IR_SEND_PIN PIN_SEND
#include <IRremote.hpp>

#include <LiquidCrystal_I2C.h>
#include <Wire.h>
#include "SparkFunBME280.h"

BME280 mySensor;
// set the LCD number of columns and rows
int lcdColumns = 16;
int lcdRows = 2;
bool airconOn = false;

// your remote control's address
char prontoDataTurnOn22Heater[] =
  "0000 006D 00C4 0000 00AA 00AA 0016 003F 0016 003D 0016 003F 0014 003F 0014 0014 0016 0014 0014 003F 0016 0014 0016 0014 0014 0014 0016 0014 0014 0016 0014 003F 0014 003F 0014 0016 0014 003F 0014 0016 0014 0014 0016 0014 0014 0014 0016 0014 0016 003D 0016 003D 0016 0014 0016 003F 0014 003F 0014 003F 0014 003F 0016 003D 0016 0014 0014 0016 0014 003F 0014 0016 0014 0014 0016 0014 0014 0014 0016 003F 0014 0014 0016 0014 0014 003F 0016 0014 0014 003F 0016 003D 0016 003F 0014 0014 0016 0014 0014 0014 0016 0014 0016 0014 0014 0014 0016 0014 0016 0014 0014 0014 0016 0014 0016 003D 0016 0014 0016 0014 0014 0014 0016 0014 0014 003F 0016 003D 0016 0014 0014 0016 0014 003F 0016 0014 0014 0014 0016 0014 0014 003F 0016 0014 0014 0014 0016 0014 0014 0016 0014 0014 0016 0014 0016 003D 0016 0014 0014 0014 0016 0014 0016 0014 0014 003F 0016 0014 0014 003F 0014 0016 0014 003F 0014 003F 0014 0016 0014 0014 0016 003F 0014 0014 0016 0014 0014 0016 0014 0014 0016 003D 0016 0014 0014 003F 0016 0014 0014 0135 00AA 00AC 0016 003D 0016 003F 0014 003F 0014 003F 0014 0016 0014 0014 0016 003D 0016 0014 0016 0014 0014 0014 0016 0014 0016 0014 0014 003F 0014 003F 0016 0014 0014 003F 0016 0012 0016 0014 0016 0014 0016 0012 0016 0014 0016 003D 0016 003D 0016 0014 0016 003D 0016 003D 0016 003F 0016 003D 0016 003D 0016 0014 0016 0012 0016 003F 0016 0012 0016 0014 0016 0014 0016 0012 0016 003D 0016 0014 0016 0014 0016 003D 0016 0014 0016 003D 0016 003D 0016 003D 0016 0014 0016 0014 0014 0014 0016 0014 0016 0014 0016 0012 0016 0014 0016 0014 0014 0014 0016 0014 0016 003D 0016 0014 0016 0012 0016 0014 0016 0014 0016 003D 0016 003D 0016 0014 0016 0012 0016 003F 0016 0012 0016 0014 0016 0014 0016 003D 0016 0014 0014 0016 0014 0014 0016 0014 0014 0016 0014 0014 0016 003D 0016 0014 0016 0014 0014 0014 0016 0014 0014 003F 0016 0014 0014 003F 0016 0014 0014 003F 0014 003F 0016 0014 0014 0016 0014 003F 0014 0016 0014 0014 0016 0014 0014 0016 0014 003F 0014 0014 0016 003F 0014 0014 0014 06C3 ";


// your remote control's address
char prontoDataTurnOff22Heater[] =
  "0000 006D 0104 0000 00AC 00AA 0018 003B 0018 003B 0018 003D 0018 003B 0018 0012 0016 0014 0016 003B 0018 0014 0016 0012 0018 0012 0016 0014 0016 0012 0016 003D 0018 003B 0018 0012 0018 003B 0018 0012 0018 0012 0016 0014 0016 0012 0016 003D 0018 0012 0018 003B 0016 0014 0016 003D 0016 003D 0018 003B 0018 003D 0016 0012 0018 003B 0018 0012 0018 003B 0018 0012 0018 0012 0016 0014 0016 0012 0016 003D 0018 0012 0016 0014 0016 003D 0016 0014 0016 003B 0018 003B 0018 003D 0016 0014 0016 003B 0018 0014 0016 0012 0018 0012 0018 0011 0018 0012 0018 0012 0018 0012 0016 003B 0018 0014 0016 0012 0018 0012 0018 0011 0018 0012 0018 0012 0018 0039 0018 0014 0016 0012 0018 003B 0018 0012 0018 0012 0018 0012 0016 0012 0018 003B 0018 003B 0018 003B 001A 0012 0016 0012 0018 0011 001A 003B 0018 0011 0018 0012 0018 0012 0016 0014 0016 003B 0018 0014 0016 003D 0018 0011 0018 003D 0016 003B 0018 0012 0018 0012 0016 0012 0018 0014 0016 003D 0016 0012 0018 003B 0018 0012 0016 003D 0018 0012 0016 003D 0018 0012 0016 0014 0016 003D 0016 003D 0016 003D 0018 003B 0018 0012 0016 0014 0016 0014 0016 0012 0016 0014 0016 0014 0016 0012 0016 0014 0016 003B 0018 003D 0018 0012 0016 0012 0018 0012 0018 0011 0018 0012 0018 0011 0018 003D 0018 0012 0016 0012 0018 003B 0018 003D 0016 0012 0018 003B 0018 003D 0016 003D 0018 003B 0018 0131 00AC 00AA 0018 003B 0018 003D 0016 003D 0018 003B 0018 0012 0016 0012 0018 003B 0018 0012 0018 0012 0018 0012 0016 0012 0018 0012 0018 003B 0018 003B 0018 0012 0018 003B 0018 0012 0018 0012 0016 0012 0018 0012 0016 003D 0018 0012 0016 003D 0016 0014 0016 003D 0016 003D 0018 003B 0016 003F 0016 0012 0016 003D 0016 0014 0016 003F 0014 0014 0016 0014 0016 0014 0014 0014 0016 003F 0014 0014 0016 0014 0014 003F 0016 0014 0014 003F 0014 003F 0016 003D 0016 0014 0014 003F 0016 0014 0014 0016 0014 0014 0016 0014 0014 0016 0014 0014 0016 0014 0014 003F 0014 0016 0014 0016 0014 0014 0014 0016 0014 0016 0014 0014 0014 003F 0016 0014 0014 0016 0014 003F 0014 0016 0014 0014 0014 0016 0014 0016 0014 003F 0014 003F 0014 003F 0014 0016 0014 0016 0014 0014 0014 003F 0016 0014 0014 0016 0014 0014 0014 0016 0014 003F 0016 0014 0014 003F 0014 0016 0014 003F 0014 0041 0012 0016 0014 0016 0014 0016 0014 0014 0014 0041 0012 0016 0014 003F 0014 0016 0014 003F 0014 0016 0014 003F 0014 0016 0014 0016 0012 0041 0012 0041 0014 003F 0014 003F 0014 0016 0014 0016 0014 0014 0014 0016 0014 0016 0012 0016 0014 0016 0014 0016 0012 0041 0012 0041 0014 0016 0014 0014 0014 0016 0014 0016 0012 0016 0014 0016 0014 003F 0014 0016 0014 0016 0012 0041 0014 003F 0012 0018 0012 0041 0012 0041 0012 0041 0012 0043 0012 06C3 ";

// set LCD address, number of columns and rows
// if you don't know your display address, run an I2C scanner sketch
LiquidCrystal_I2C lcd(0x27, lcdColumns, lcdRows);

void setup()
{
  Serial.begin(9600);
  IrSender.begin();
  Serial.println("Reading basic values from BME280");

  Wire.begin();
  mySensor.setI2CAddress(0x77);
  if (mySensor.beginI2C() == false) { //Begin communication over I2C
    Serial.println("The sensor did not respond. Please check wiring.");
    while (1) { //Freeze
    }
  }
  // initialize LCD
  lcd.init();
  // turn on LCD backlight
  lcd.backlight();
}

void loop()
{
  float temp = mySensor.readTempC();
  float humidity = mySensor.readFloatHumidity();

  Serial.println();

  delay(6000);
  // set cursor to first column, first row
  lcd.setCursor(0, 0);
  // print message
  lcd.print("Temp : ");
  lcd.print(temp);
  // set cursor to first column, second row
  lcd.setCursor(0, 1);
  lcd.print("humidity : ");
  lcd.print(humidity);
  delay(10000);
  // clears the display to print new message
  lcd.clear();

  if (temp > 28 && !airconOn) {
    Serial.println("Sending IR code Turn ON");
    IrSender.sendPronto(prontoDataTurnOn22Heater);
    airconOn = true;
  }
  if (temp < 26 && airconOn) {
    Serial.println("Sending IR code Turn OFF");
    IrSender.sendPronto(prontoDataTurnOff22Heater);
    airconOn = false;
  }
}
